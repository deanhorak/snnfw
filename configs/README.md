# SNNFW Configuration Files

This directory contains configuration files for MNIST digit recognition experiments using the SNNFW framework.

## Available Configurations

### `mnist_config.json` (Default)
**Purpose**: Standard configuration achieving 81.20% accuracy

**Key Parameters**:
- Grid: 7×7 (49 regions)
- Orientations: 8
- k-NN: k=5
- Training: 5,000 examples per digit (50,000 total)
- Testing: 10,000 images

**Expected Accuracy**: ~81.20%

**Usage**:
```bash
cd build
./mnist_optimized ../configs/mnist_config.json
```

---

### `mnist_config_5x5.json`
**Purpose**: Smaller grid for faster training with reduced spatial resolution

**Key Parameters**:
- Grid: 5×5 (25 regions) ← **Different from default**
- Region size: 5×5 pixels ← **Different from default**
- Orientations: 8
- k-NN: k=5
- Training: 5,000 examples per digit

**Expected Accuracy**: ~75-78% (lower due to reduced spatial resolution)

**Usage**:
```bash
# First generate the 5×5 SONATA network
python3 scripts/generate_mnist_sonata_5x5.py

# Then run the experiment
cd build
./mnist_optimized ../configs/mnist_config_5x5.json
```

**Trade-offs**:
- ✅ Faster training (200 neurons vs 392)
- ✅ Lower memory usage
- ❌ Lower accuracy due to coarser spatial features

---

### `mnist_config_k3.json`
**Purpose**: Test k-NN with fewer neighbors (k=3)

**Key Parameters**:
- Grid: 7×7
- Orientations: 8
- k-NN: k=3 ← **Different from default**
- Training: 5,000 examples per digit

**Expected Accuracy**: ~80-81% (slightly lower than k=5)

**Usage**:
```bash
cd build
./mnist_optimized ../configs/mnist_config_k3.json
```

**Trade-offs**:
- ✅ Faster classification (fewer neighbors to compare)
- ❌ More sensitive to outliers
- ❌ Slightly lower accuracy

---

### `mnist_config_k10.json`
**Purpose**: Test k-NN with more neighbors (k=10)

**Key Parameters**:
- Grid: 7×7
- Orientations: 8
- k-NN: k=10 ← **Different from default**
- Training: 5,000 examples per digit

**Expected Accuracy**: ~81-82% (similar to k=5)

**Usage**:
```bash
cd build
./mnist_optimized ../configs/mnist_config_k10.json
```

**Trade-offs**:
- ✅ More robust to outliers
- ✅ Smoother decision boundaries
- ❌ Slower classification (more neighbors to compare)

---

### `mnist_config_fast.json`
**Purpose**: Quick testing and debugging with reduced dataset

**Key Parameters**:
- Grid: 7×7
- Orientations: 8
- k-NN: k=5
- Training: 1,000 examples per digit (10,000 total) ← **Different from default**
- Testing: 1,000 images ← **Different from default**

**Expected Accuracy**: ~75-78% (lower due to less training data)

**Usage**:
```bash
cd build
./mnist_optimized ../configs/mnist_config_fast.json
```

**Trade-offs**:
- ✅ Very fast training (~1-2 minutes)
- ✅ Good for debugging and quick iterations
- ❌ Lower accuracy due to less training data

---

### `mnist_config_no_sonata.json`
**Purpose**: Disable SONATA and use manual network construction

**Key Parameters**:
- Grid: 7×7
- Orientations: 8
- k-NN: k=5
- Training: 5,000 examples per digit
- SONATA: **disabled** ← **Different from default**

**Expected Accuracy**: ~81.20% (same as default)

**Usage**:
```bash
cd build
./mnist_optimized ../configs/mnist_config_no_sonata.json
```

**Use Cases**:
- Testing fallback mechanism
- Debugging network construction
- Environments without HDF5/SONATA support

---

## SONATA Network Files

### `mnist_network.h5`
Standard 7×7 grid network (392 neurons)

**Generated by**:
```bash
python3 scripts/generate_mnist_sonata.py
```

**Structure**:
- Population: `layer1_neurons`
- Neurons: 392 (7×7 grid × 8 orientations)
- Attributes: `window_size_ms`, `similarity_threshold`, `max_patterns`, `region_row`, `region_col`, `orientation`, `neuron_index`

---

### `mnist_network_5x5.h5`
Smaller 5×5 grid network (200 neurons)

**Generated by**:
```bash
python3 scripts/generate_mnist_sonata_5x5.py
```

**Structure**:
- Population: `layer1_neurons`
- Neurons: 200 (5×5 grid × 8 orientations)
- Attributes: Same as standard network

---

## Creating Custom Configurations

### Step 1: Copy an existing configuration

```bash
cp configs/mnist_config.json configs/my_experiment.json
```

### Step 2: Edit parameters

```json
{
  "network": {
    "grid_size": 10,  // Change to 10×10 grid
    ...
  },
  "classification": {
    "k_neighbors": 7  // Change k to 7
  }
}
```

### Step 3: Generate SONATA network (if grid size changed)

```bash
# Edit scripts/generate_mnist_sonata.py
# Change GRID_SIZE = 10

python3 scripts/generate_mnist_sonata.py
```

### Step 4: Run experiment

```bash
cd build
./mnist_optimized ../configs/my_experiment.json
```

---

## Parameter Recommendations

### Grid Size
- **5×5**: Fast, lower accuracy (~75-78%)
- **7×7**: Balanced, good accuracy (~81%) ← **Recommended**
- **10×10**: Slower, potentially higher accuracy (~82-84%)

### k-NN Neighbors
- **k=3**: Fast, more sensitive to noise
- **k=5**: Balanced ← **Recommended**
- **k=7-10**: More robust, slower

### Training Examples
- **1,000/digit**: Fast testing (~75-78%)
- **5,000/digit**: Standard ← **Recommended**
- **6,000/digit**: Full dataset (marginal improvement)

### Temporal Window
- **100ms**: Faster processing, may miss temporal patterns
- **200ms**: Balanced ← **Recommended**
- **500ms**: Captures more temporal detail, slower

---

## Experiment Workflow

### 1. Quick Test (Fast Configuration)
```bash
./mnist_optimized ../configs/mnist_config_fast.json
```
**Time**: ~1-2 minutes  
**Purpose**: Verify code changes, quick debugging

### 2. Parameter Sweep (k-NN)
```bash
./mnist_optimized ../configs/mnist_config_k3.json
./mnist_optimized ../configs/mnist_config.json      # k=5
./mnist_optimized ../configs/mnist_config_k10.json
```
**Time**: ~15-20 minutes each  
**Purpose**: Find optimal k value

### 3. Architecture Comparison
```bash
./mnist_optimized ../configs/mnist_config_5x5.json
./mnist_optimized ../configs/mnist_config.json      # 7×7
```
**Time**: ~10-20 minutes each  
**Purpose**: Compare grid sizes

### 4. Full Evaluation (Default Configuration)
```bash
./mnist_optimized ../configs/mnist_config.json
```
**Time**: ~15-20 minutes  
**Purpose**: Final accuracy measurement

---

## Troubleshooting

### "Failed to open config file"
**Solution**: Check that you're running from the `build` directory and using relative path `../configs/...`

### "Unable to open file mnist_network.h5"
**Solution**: Generate the SONATA file first:
```bash
python3 scripts/generate_mnist_sonata.py
```

### "Failed to open image file"
**Solution**: Update the `data` section in the config file with correct paths to your MNIST dataset

### Lower accuracy than expected
**Possible causes**:
- Using fast configuration (fewer training examples)
- Using smaller grid (5×5 instead of 7×7)
- Different k value
- Different random seed in data selection

---

## See Also

- [Configuration System Documentation](../docs/CONFIGURATION_SYSTEM.md)
- [MNIST Experiments Documentation](../MNIST_EXPERIMENTS.md)
- [SONATA Format Specification](https://github.com/AllenInstitute/sonata)

